{"name":"Enabled computers inactive for 180 days - MSSQL Failover Cluster","guid":"d263e621-7f1b-4efb-ad25-098fc7d4fb72","prebuilt":false,"platforms":["Active Directory"],"category":"Active Directory Hygiene","description":null,"query":"WITH 180 as inactive_days\nMATCH (n:Computer)\nWHERE n.enabled = true\nAND n.lastlogontimestamp < (datetime().epochseconds - (inactive_days * 86400)) // Replicated value\nAND n.lastlogon < (datetime().epochseconds - (inactive_days * 86400)) // Non-replicated value\nAND n.whencreated < (datetime().epochseconds - (inactive_days * 86400)) // Exclude recently created principals\nAND ANY(type IN n.serviceprincipalnames WHERE \n    toLower(type) CONTAINS 'mssqlservercluster' OR \n    toLower(type) CONTAINS 'mssqlserverclustermgmtapi' OR \n    toLower(type) CONTAINS 'msclustervirtualserver')\nRETURN n\nLIMIT 1000","revision":1,"resources":["https://learn.microsoft.com/en-us/troubleshoot/windows-server/high-availability/troubleshoot-issues-accounts-used-failover-clusters#troubleshoot-password-issues-with-the-cluster-name-account"],"acknowledgements":["Martin Sohn Christensen, @martinsohndk"]}