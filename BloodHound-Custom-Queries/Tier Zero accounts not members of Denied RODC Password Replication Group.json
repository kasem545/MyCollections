{"name":"Tier Zero accounts not members of Denied RODC Password Replication Group","guid":"e9613406-e346-410b-a033-690a6cf0c708","prebuilt":false,"platforms":["Active Directory"],"category":"Active Directory Hygiene","description":null,"query":"// Get all Tier Zero accounts that are members of Denied RODC Password Replication Group\nMATCH (n:Base)-[:MemberOf*1..]->(m:Group)\nWHERE ((n:Tag_Tier_Zero) OR COALESCE(n.system_tags, '') CONTAINS 'admin_tier_0')\nAND (n:User OR n:Computer)\nAND m.objectid ENDS WITH '-519'\nWITH COLLECT(n.objectid) AS MembersOfDeniedGroup\n\n// Get all Tier Zero accounts\nMATCH (x:Base)\nWHERE ((x:Tag_Tier_Zero) OR COALESCE(x.system_tags, '') CONTAINS 'admin_tier_0')\nAND (x:User OR x:Computer)\n\n// Filter the members of Denied RODC Password Replication Group\nAND NOT x.objectid IN MembersOfDeniedGroup\nRETURN x","revision":2,"resources":[],"acknowledgements":["Martin Sohn Christensen, @martinsohndk"]}